# We get an Node.js image. We don't get an Alpine one because it don't have apt by default.
FROM node:22-slim

# We install openssl for Prisma
RUN apt-get update -y && apt-get install -y openssl

# We create en /app folder and get in
WORKDIR /app

# We copy package.json from root and backend to be able to run "npm install"
COPY ./package.json ./
COPY ./backend/package.json ./backend/

# Need for prisma generate
COPY ./backend/prisma/schema.prisma ./backend/prisma/

# Install from root only, using npm workspaces
RUN npm install

WORKDIR /app/backend

# Generate prisma schema in node_modules
RUN npx prisma generate

EXPOSE 3000