(()=>{"use strict";function t(t,s,i){return Math.min(Math.max(t,s),i)}const s=JSON.parse('{"lv1":{"levelNumber":1,"ballSpeed":200,"paddleWidthRation":0.2,"paddleHeightRation":0.04,"map":[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,4,4,4,0,0,0],[0,0,0,4,2,4,0,0,0],[0,0,0,4,4,4,0,0,0]]},"lv2":{"levelNumber":2,"ballSpeed":200,"paddleWidthRation":0.2,"paddleHeightRation":0.04,"map":[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[1,1,1,1,1,1,1,1,1],[5,5,5,5,5,5,5,5,5],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,3,3,0,0,0,3,3,0]]},"lv3":{"levelNumber":3,"ballSpeed":200,"paddleWidthRation":0.2,"paddleHeightRation":0.04,"map":[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0],[2,0,2,2,0,2,2,0,2],[3,1,3,3,1,3,3,1,3]]}}'),i=JSON.parse('{"1":{"color":"rgb(110, 201, 251)","hardness":2,"points":2},"2":{"color":"#FF102Aff","hardness":2,"points":2},"3":{"color":"grey","hardness":-1},"4":{"color":"yellow","hardness":1,"points":1},"5":{"color":"white","hardness":1,"points":1}}');class h{constructor({t,i:s,h:i,o:h,map:e}){this.t=t,this.i=s,this.h=i,this.o=h,this.map=e}}class e{constructor(t,s,i,h,e){this.radius=t,this.x=s,this.y=i,this.dx=h,this.dy=e,this.l=new Image,this.l.src="./assets/images/ball.png",this.u=new Audio("./assets/sonds/plankImpact.wav"),this.p=new Audio("./assets/sonds/blockImpact.wav"),this.u.load(),this.p.load()}draw(t){t.drawImage(this.l,this.x-this.radius,this.y-this.radius,2*this.radius,2*this.radius),t.shadowColor="rgba(0, 0, 0, 0.5)",t.shadowBlur=10,t.shadowOffsetX=-this.dx/30,t.shadowOffsetY=-this.dy/30,t.fill(),t.shadowColor="transparent"}m(){this.u.play(),this.u.currentTime=0}v(){this.p.play(),this.p.currentTime=0}}class o{constructor(t,s,i,h){this.width=t,this.height=s,this.x=i,this.y=h,this.k=0,this.M=!1,this.color="black",this.A=new Image,this.A.src="./assets/images/plank.png",this.A.onload=()=>{this.S=!0}}draw(t,s){t.drawImage(this.A,this.x,this.y,this.width,this.height)}move(s,i,h){this.x=t(this.x+s*this.k*1.1,h-10,i-this.width-h+10)}R(t){this.M=!0,this.k="right"===t?1:-1}L(){this.M=!1,this.k=0}}class n{constructor(t,s,i,h,e,o,n){this.x=t,this.y=s,this.width=i,this.height=h,this.color=e,this.I=o,this.N=n}draw(t){t.beginPath(),t.fillStyle="black",t.rect(this.x,this.y,this.width,this.height),t.fill(),t.beginPath(),t.fillStyle=this.color,t.rect(this.x+2,this.y+2,this.width-4,this.height-4),t.fill()}}class a{constructor(t,s,h,e,o){this.W=[],this.B=o;for(let o=0;o<this.B.length;o++){const a=(t-2*h)/this.B[o].length,l=(s-e)/20;for(let t=0;t<this.B[o].length;t++)if(0!==this.B[o][t]){const s=i[this.B[o][t]];this.W.push(new n(h+t*a,e+o*l,a,l,s.color,s.I,s.points))}}}draw(t){const s=this.W.filter((t=>0!==t.I));for(const i of s)i.draw(t)}}class l{constructor(t){this.canvas=t,this.F=t.getContext("2d"),this.F.imageSmoothingEnabled=!1,this.O=new Audio("./assets/sonds/gameOver.mp3"),this.O.load(),this.C=new Audio("./assets/sonds/win.mp3"),this.C.load(),this.V=new Audio("./assets/sonds/newLevel.mp3"),this.V.load(),this.D=37,this.H=37,this.map=null,this.G=null,this.P=null,this.U=!1,this.q=!1,this.J=2,this.K(),this.T=localStorage.getItem("highScore")??0,this.Y(),this.$(1)}j(){this.U=!1,this.q=!1,this.J=2,this.K(),this.$(1)}$(t){const i="lv"+t;this.level=new h(s[i]),this.X=new Image,this.X.src="./assets/images/backgrounds/background"+this.level.t+".png",this.X.onload=()=>{this.Z=!0},this.map=new a(this.canvas.width,this.canvas.height,this.H,this.D,this.level.map),this._(),this.tt=!1,this.st(),"lv1"!==i&&this.V.play(),this.it=null}_(){const t=this.canvas.width*this.level.h,s=this.canvas.height*this.level.o,i=this.canvas.width/2-t/2,h=this.canvas.height-50-s;this.G=new o(t,s,i,h);const n=s/4,a=this.canvas.width/2,l=this.canvas.height-50-s-n;this.P=new e(n,a,l,0,0)}start(){this.tt||(this.P.dx=5*Math.random(),this.P.dy=-Math.sqrt(this.level.i-this.P.dx**2),this.tt=!0,this.it||(this.it=Date.now()))}ht(){document.getElementById("scoreValue").textContent=this.et}Y(){document.getElementById("highScoreValue").textContent=this.T}st(){document.getElementById("levelValue").textContent=this.level.t}K(){this.et=0,document.getElementById("scoreValue").textContent=this.et}ot(){this.J-=1,this.tt=!1,this._()}nt(){let t=this.H;const s=this.canvas.height-30;for(let i=0;i<this.J;i++)this.F.drawImage(this.G.A,t,s,100,30),t+=100}lt(t){this.F.font="58px MyWebFont",this.F.textAlign="center",this.F.fillStyle="white",this.F.fillText(t,this.canvas.width/2,this.canvas.height/2)}rt(t){this.F.font="40px MyWebFont",this.F.fillStyle=`rgba(255, 255, 255, ${t})`,this.F.fillText("Click to restart",this.canvas.width/2,this.canvas.height/1.6)}ct(){if(this.U)return;if(this.q){this.F.clearRect(0,0,this.canvas.width,this.canvas.height),this.Z&&this.F.drawImage(this.X,0,0,this.canvas.width,this.canvas.height),this.map.draw(this.F),this.P.draw(this.F),this.G.draw(this.F,this.canvas.height),this.nt(),this.lt("GAME OVER");const t=2e3,s=performance.now()%t/t,i=Math.abs(Math.cos(s*Math.PI));return void this.rt(i)}if(0===this.map.W.filter((t=>t.I>0)).length){if(this.level.t++,void 0===s["lv"+this.level.t])return this.U=!0,this.lt("YOU WIN"),void this.C.play();this.$(this.level.t)}this.P.y+this.P.radius<=this.G.y?(this.F.clearRect(0,0,this.canvas.width,this.canvas.height),this.Z&&this.F.drawImage(this.X,0,0,this.canvas.width,this.canvas.height),this.dt(this.map,this.G),this.map.draw(this.F),this.P.draw(this.F),this.G.draw(this.F,this.canvas.height),this.nt()):this.J>0?this.ot():(this.q=!0,this.O.play())}dt(){this.P.y+this.P.dy-this.P.radius-this.D<0&&(this.P.dy=-this.P.dy),this.ut(),this.wt(this.G,this.P)&&this.P.dy>0&&(this.P.dy=-this.P.dy,this.P.dx=.06*(this.P.x-(this.G.x+this.G.width/2)),this.P.m()),(this.P.x+this.P.dx+this.P.radius+this.H>this.canvas.width||this.P.x+this.P.dx-this.P.radius-this.H<0)&&(this.P.dx=-this.P.dx),this.P.x+=this.P.dx,this.P.y+=this.P.dy}ut(){const t=this.gt();if(void 0!==t&&(t.x<=this.P.x&&this.P.x<=t.x+t.width?(this.P.y-=2*this.P.dy,this.P.dy*=-1):(this.P.x-=2*this.P.dx,this.P.dx*=-1),-1!==t.I&&(t.I-=1,this.P.v()),0===t.I)){const s=(Date.now()-this.it)/1e3,i=Math.max(1,Math.round((60-s)/6));this.et+=t.N*i,this.et>this.T&&(this.T=this.et,localStorage.setItem("highScore",this.T),this.Y())}}gt(){const t=[];let s=null;const i=this.map.W.filter((t=>0!==t.I));for(const s of i)this.wt(s,this.P)&&t.push(s);if(t.length<=1)s=t[0];else{const i={x:this.P.x-this.P.dx,y:this.P.y-this.P.dy};s=this.vt(i,t)}return s}vt(t,s){const i=[];for(const h of s){const s=Math.abs(h.x+h.width/2-t.x),e=Math.abs(h.y+h.height/2-t.y),o=Math.sqrt(s**2+e**2);i.push({ft:o,bt:h})}return i.reduce(((t,s)=>s.ft<t.ft?s:t)).bt}wt(t,s){const i=Math.abs(t.x+t.width/2-s.x),h=Math.abs(t.y+t.height/2-s.y);return i<=s.radius+t.width/2&&h<=s.radius+t.height/2}kt(t){if(this.G.M){this.Mt||(this.Mt=t);const s=t-this.Mt;this.G.move(s,this.canvas.width,this.H),this.tt||(this.P.x=this.G.x+this.G.width/2),this.Mt=t,requestAnimationFrame(this.kt.bind(this))}else this.Mt=null}yt(t){this.U||(this.q&&"Enter"===t.key?this.j():("ArrowRight"!==t.key&&"ArrowLeft"!==t.key||(this.G.R("ArrowRight"===t.key?"right":"left"),requestAnimationFrame(this.kt.bind(this))),"ArrowUp"===t.key&&this.start()))}At(t){"ArrowRight"!==t.key&&"ArrowLeft"!==t.key||this.G.L()}}document.addEventListener("DOMContentLoaded",(()=>{const s=document.getElementById("arkanoid"),i=new l(s);setInterval(i.ct.bind(i),1e3/60),setInterval((()=>{i.tt&&i.ht()}),1e3/30),addEventListener("keydown",i.yt.bind(i)),addEventListener("keyup",i.At.bind(i)),addEventListener("click",(t=>{const h=s.getBoundingClientRect(),e=t.clientX-h.left,o=t.clientY-h.top;e>=0&&e<=s.width&&o>=0&&o<=s.height&&i.q&&i.j()})),document.addEventListener("touchstart",(t=>{t.preventDefault(),i.start(),i.q&&i.j()})),document.addEventListener("touchmove",(s=>{s.preventDefault();const h=s.touches[0].clientX-i.canvas.getBoundingClientRect().left;i.G.x=t(h-i.G.width/2,i.H-10,i.canvas.width-i.G.width-i.H+10),i.tt||(i.P.x=i.G.x+i.G.width/2)})),document.addEventListener("touchend",(t=>{t.preventDefault()}))}))})();